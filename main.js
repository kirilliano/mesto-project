(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function n(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}e.d({},{xS:()=>P}),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup__container")||t.target.classList.contains("popup_open-image"))&&r(e),t.target.classList.contains("popup__close-button")&&r(e)}))}));var c={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16",headers:{authorization:"bb462bb4-22b0-43a6-bcbf-709edef952c3","Content-Type":"application/json"}};function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o={method:t,headers:c.headers};return n&&(o.body=JSON.stringify(n)),fetch("".concat(c.baseUrl,"/").concat(e),o).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}var u=document.querySelector(".popup_open-image"),i=document.querySelector(".popup__image"),l=document.querySelector(".popup__image-caption"),s=document.querySelector(".elements"),d=document.querySelector(".element__template").content;function p(e,t){var n=t.querySelector(".element").cloneNode(!0),r=n.querySelector(".element__likes-counter"),c=n.querySelector(".element__button"),s=n.querySelector(".element__image");s.setAttribute("alt",e.name),s.setAttribute("src",e.link),n.querySelector(".element__title").textContent=e.name,r.textContent=e.likes.length,function(e){return e.likes.some((function(e){return e._id===P}))}(e)&&c.classList.add("element__button_active"),c.addEventListener("click",(function(t){var n;t.target.classList.contains("element__button_active")?(n=e._id,a("cards/likes/".concat(n),"DELETE")).then((function(e){t.target.classList.toggle("element__button_active"),r.textContent=e.likes.length})).catch((function(e){console.log("Ошибка ".concat(e.status))})):function(e){return a("cards/likes/".concat(e),"PUT")}(e._id).then((function(e){t.target.classList.toggle("element__button_active"),r.textContent=e.likes.length})).catch((function(e){console.log("Ошибка ".concat(e.status))}))}));var d=n.querySelector(".element__button-delete");return P!==e.owner._id?d.classList.add("element__button-delete_disactive"):d.addEventListener("click",(function(){var t;(t=e._id,a("cards/".concat(t),"DELETE")).then((function(){n.remove()})).catch((function(e){console.log("Ошибка ".concat(e.status))}))})),s.addEventListener("click",(function(){return t=e.name,n=e.link,i.setAttribute("src",n),i.setAttribute("alt",t),l.textContent=t,void o(u);var t,n})),n}var m=document.querySelector(".profile__edit-button"),f=document.querySelector("#username-field"),_=document.querySelector("#userinfo-field"),v=document.querySelector(".profile__name"),y=document.querySelector(".profile__info"),S=document.querySelector("#popupEditProfile"),b=S.querySelector(".popup__form"),h=S.querySelector("#saveNewProfile");function q(e){e.textContent="Сохранить"}m.addEventListener("click",(function(){f.value=v.textContent,_.value=y.textContent,o(S)})),b.addEventListener("submit",(function(e){var t,n;e.preventDefault(),h.textContent="Сохранение...",(t=f.value,n=_.value,a("users/me","PATCH",{name:t,about:n})).then((function(e){v.textContent=e.name,y.textContent=e.about,r(S)})).catch((function(e){console.log("Ошибка ".concat(e.status))})).finally((function(){setTimeout(q,1e3,h)}))}));var g,C=document.querySelector("#phototitle-field"),L=document.querySelector("#photolink-field"),E=document.querySelector(".profile__add-button"),k=document.querySelector("#popupAddPhoto"),x=k.querySelector("#formAddPhoto"),A=x.querySelector("#createNewCard");E.addEventListener("click",(function(){o(k)})),x.addEventListener("submit",(function(e){var t,n;e.preventDefault(),A.textContent="Сохранение...",(t=C.value,n=L.value,a("cards","POST",{name:t,link:n})).then((function(t){s.prepend(p(t,d)),r(k),e.target.reset(),A.classList.add("popup__button_disabled"),A.disabled=!0})).catch((function(e){console.log("Ошибка ".concat(e.status))})).finally((function(){q(A)}))})),g={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"},Array.from(document.querySelectorAll(g.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,n),t(o,r,n)}))}))}(e,g)})),document.querySelector(".popup_open-image"),document.querySelector(".popup__image"),document.querySelector(".popup__image-caption");var P,T=document.querySelector(".profile__avatar-container"),w=T.querySelector(".profile__avatar"),B=document.querySelector("#popupChangeAvatar"),D=B.querySelector("#changeAvatarForm"),j=D.querySelector("#avatar-url"),O=D.querySelector("#changeAvatarSubmitButton");T.addEventListener("click",(function(){o(B)})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),O.textContent="Сохранение...",(t=j.value,a("users/me/avatar","PATCH",{avatar:t})).then((function(e){w.src=e.avatar,r(B)})).catch((function(e){console.log("Ошибка ".concat(e.status))})).finally((function(){setTimeout(q,1e3,O)}))})),Promise.all([a("users/me"),a("cards")]).then((function(e){var t;t=e[0]._id,P=t,v.textContent=e[0].name,y.textContent=e[0].about,w.src=e[0].avatar,e[1].forEach((function(e){s.append(p(e,d))}))})).catch((function(e){console.log("Ошибка ".concat(e.status))}))})();